Конфигурирование сервера
#####################

PostgreSQL является сложной системой, которая должна обеспечивать работоспособность в разных условиях.

Для настройки системы используются различные параметры, которые, в свою очередь, расположены в файлах конфигурации.
Большую часть работы администраторы выполняют именно с параметрами систем.

Для Postgres параметры конфигурации могут быть настроены для:

- всего кластера;
- для отдельной базы данных;
- для отдельного пользователя;
- для отдельной команды, транзакции.

Основной файл конфигурации
***************************

**postgresql.conf**

В зависимости от операционной системы может быть расположен в разных каталогах, но обычно располагается 
в системном каталоге кластера postgres. Для ALT Linux по-умолчанию расположен в /var/lib/pgsql/data1,
в UBUNTU **/etc/postgresql/16/main**

Для просмотра местонахождения файла postgresql.conf можно воспользоваться командой **SHOW**, которая показывает значения
параметров на текущий момент.

В сеансе psql:

::

	SHOW config_file;

.. figure:: img/04_show_config_file.png
       :scale: 100 %
       :align: center
       :alt: asda

В командной строке 

::

	psql -U postgres -c 'SHOW config_file;'
	
.. figure:: img/04_show_config_file_cml.png
       :scale: 100 %
       :align: center
       :alt: asda


При запуске исполняемого файла сервера с помощью аргумента командной строки 
**-c config_file** можно задать требуемое местонахождение файла конфигурации.

Файл является хорошо документированным. Данные хранятся в виде **ключ-значение**.

После внесения в файл изменений необходимо, чтобы сервер перечитал файл, 
а для некоторых параметров требуется перезагрузка сервера.

::

	pg_ctl -D /var/lib/pgsql/data reload
	
или в терминале psql

::

	SELECT pg_reload_conf();


pg_ctl -D /var/lib/pgsql/data restart

Позже будет показано, как определить необходимость перезагрузки или перечитывания для разных параметров.

**pg_read_file()** — системная функция в PostgreSQL, которая возвращает содержимое текстового файла с локальной файловой системы.  

- Возвращает фрагмент файла с заданного смещения (offset), размером не больше length байт (размер может быть меньше, если файл кончится раньше).
- Если смещение offset отрицательно, оно отсчитывается от конца файла. 
- Если параметры offset и length опущены, возвращается всё содержимое файла. 
- Прочитанные из файла байты обрабатываются как символы в серверной кодировке; если они оказываются недопустимыми для этой кодировки, возникает ошибка.


::
	
	SELECT pg_read_file('/var/lib/pgsql/data/postgresql.conf');

.. figure:: img/04_pg_read_file_config_file.png
       :scale: 100 %
       :align: center
       :alt: asda
	   
К основному конфигурационному файлу postgresql.conf можно подключать дополнительные файлы конфигурации. Директивы подключения:

- include_dir — каталог с дополнительными файлами конфигурации;
- include — включает дополнительный файл конфигурации;
- include_if_exists — включает дополнительный файл конфигурации, если он существует.